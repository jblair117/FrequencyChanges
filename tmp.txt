<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="pragma" content="no-cache" />
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
        <link href="../static/css/style.css" rel="stylesheet">
        <script type="text/javascript">
        //checking this part
        var valid_places_var = '{{ valid_places }}'
        var invalid_places_var = '{{ invalid_places }}'
        //modified
        // var final_marking_name = '{{ final_marking_name }}'
        // alert(final_marking_name);
        var generate_button = false;
        function changeImage(img_name)
        {   
            var process_img = img_name.replace(" ","");
            console.log(process_img);
            var img = document.getElementById("image");
            img.src="../static/image/" + process_img + ".png";
        }

        /*
        function changeOriImage()
        {
            const tmp = places_var.replace("{","").replace("}","");
            const places_list = tmp.split(",");
            var img = document.getElementById("image");
            img.src="../static/image/petri_net.png";
            
            // alert(places_list);
            for(var i=0; i < places_list.length; i++){
                var com_elem = 'btn' + places_list[i];
                // alert(com_elem);
                var elem = document.getElementById(com_elem);
                elem.parentNode.removeChild(elem);
            }
            generate_button = false;
        }
         */

        function myFunc(valid_places_var, invalid_places_var) {
            // if (generate_button == false){
                // alert(invalid_places_var);
                // console.log(places_var);
                const tmp_valid = valid_places_var.replace("[","").replace("]","").replace(", ", ",");
                const tmp_invalid = invalid_places_var.replace("[","").replace("]","").replace(", ", ",");
                alert(tmp_invalid);
                let valid_places_list = tmp_valid.split(",").sort();
                let invalid_places_list = tmp_invalid.split(",").sort();
                // console.log(places_list);
                alert(valid_places_list);
                alert(invalid_places_list);

                // alert(places_list)
                for(var i=0; i < valid_places_list.length; i++)
                (function () {
                    alert(invalid_places_list.length)
                    var btn = document.createElement("BUTTON");
                    var image_name = places_list[i];
                    btn.id = 'btn' + places_list[i];
                    btn.innerHTML = places_list[i];
                    btn.setAttribute("value", places_list[i]);
                    btn.setAttribute("text",places_list[i]);
                    btn.style.fontSize = "22px";
                    btn.style.backgroundColor = '#4CAF50';
                    let buttonDiv = document.getElementById("buttons");
                    buttonDiv.appendChild(btn);
                    // generate_button = true;
                    // if (String(places_list[i]).trim() != String(final_marking_name).trim()){
                    //     btn.addEventListener("click", function() {
                    //         changeImage(image_name);
                    //         }   
                    //     );
                    // }
                    btn.addEventListener("click", function() {
                            changeImage(image_name);
                            }   
                        );
                    // else{
                    //     btn.addEventListener("click", function() {
                    //         // changeImage("no_path")
                    //         alert("This is the final marking. No path indicated.")
                    //         }   
                    //     );
                    // }
                })();
                for(var i=0; i < invalid_places_list.length; i++)
                (function () {
                    var btn = document.createElement("BUTTON");
                    var image_name = places_list[i];
                    btn.id = 'btn' + places_list[i];
                    btn.innerHTML = places_list[i];
                    btn.setAttribute("value", places_list[i]);
                    btn.setAttribute("text",places_list[i]);
                    btn.style.fontSize = "22px";
                    btn.style.backgroundColor = '#4CAF50';
                    let buttonDiv = document.getElementById("buttons");
                    buttonDiv.appendChild(btn);
                    // generate_button = true;
                    // if (String(places_list[i]).trim() != String(final_marking_name).trim()){
                    //     btn.addEventListener("click", function() {
                    //         changeImage(image_name);
                    //         }   
                    //     );
                    // }
                    btn.addEventListener("click", function() {
                            changeImage(image_name);
                            }   
                        );
                    // else{
                    //     btn.addEventListener("click", function() {
                    //         // changeImage("no_path")
                    //         alert("This is the final marking. No path indicated.")
                    //         }   
                    //     );
                    // }
                })();
            // }
        }

        function updateTextInput(val) {
          document.getElementById('textInput').value=val; 
        }


        function updateTextInput(val) {
          document.getElementById('textInput').value=val; 
        }
        </script>
    </head>

    <body id = "body-wrapper">

        <div id = "header">
            <h1>Process Mining Visual Analytic Tool</h1>
        </div>

        <div id = "petri-net-wrapper">
            <h1>Generated Petri Net</h1>
            <img src="../static/image/petri_net.png"
                 style = "border: 3px solid #0e72ab;"
                 id = "image" alt="petri_net">
            <h2>Select Your Places</h2>

            <p style = "font-size: 120%; line-height: 120%;">Click a button below to see the transitions for the named place (invalid places are greyed out)!
            </p>
            <button id="preview" onclick="myFunc('{{ places }}', '{{invalid_places}}');">Preview </button>
            <!-- <button id="origin_clickme" onclick="changeOriImage();">The original Image</button> -->

            <div id="buttons"></div>
            <p>{{valid_places}}</p>
            <p>{{invalid_places}}</p>
            <!-- <div id = "sliders">
            </div> -->
            <p style = "font-size: 120%; line-height: 120%;">Type below a valid place name you're interested in!</p>
                <!-- loading might need to added here -->
                <form action = "http://localhost:5000/select_places" method="POST">
                    <!-- <form action = "https://process-mining-zkathz2wkq-ts.a.run.app/select_places" method="POST"> -->
                    <input type="text" id="select_places" name="select_places" size="1%" maxlength="2">
                    <br><br>
                    <!-- <input type="range" name="rangeInput" min="0" max="100" onchange="updateTextInput(this.value);"> -->
                    Model: <select name="modelSelect" id="modelSelect">
                    <!-- <select name="modelSelect" id="modelSelect" onchange="this.form.submit()"></select> -->
                                <option value="rfb" selected>rfb</option>
                                <option value="l1">l1</option>
                                <option value="l2">l2</option>
                            </select> &nbsp;
                    Penalty value: <input type="range"  style="display: inline;" name="PenInputName" id="PenInputId" value="5" min="1" max="10" oninput="PenOutputId.value = PenInputId.value">
                    <output name="PenOutputName" id="PenOutputId">5 &nbsp;</output>
                    <br><br>
                    <input type="submit" class="submit" value="Submit" onclick="$('#loading').show();">
                    <div id="loading" style="display:none;"><img src="../static/image/loading.gif" alt="" />    Give me ~8 minutes!</div>
                </form>
            </div>
        </div>
        <div id = "footer">
            <h1>Â© 2021 Prof. Simon Poon's Project Group</h1>
        </div>
    </body>
</html>